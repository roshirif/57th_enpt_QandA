<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Q&A一覧</title>

<!-- DataTables CSS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">

<style>
  body{font-family:system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif; padding:12px; }
  h1{font-size:1.4rem; margin-bottom:10px;}
  .note{font-size:0.9rem;color:#666;margin-bottom:10px;}
  table.dataTable td{word-break:break-word;}
  @media (max-width:600px){
    h1{font-size:1.1rem;}
  }
  .error {color:#b00;}
</style>
</head>
<body>
  <h1>質問一覧</h1>
  <div class="note">※最新の公開分のみ表示されます</div>
  <div id="status">読み込み中…</div>
  <table id="qaTable" class="display responsive nowrap" style="width:100%; display:none;">
    <thead>
      <tr>
        <th>日時</th>
        <th>質問者</th>
        <th>宛先</th>
        <th>質問</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- jQuery + DataTables -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbzQEzqei00rjgpCLIp0l4YVq4Rg3-z0HRrdrft4OZyZ3m1SUKBA8COOI9tceMhS4l41Vw/exec";

    function showError(msg){
      document.getElementById('status').innerHTML = '<div class="error">'+msg+'</div>';
    }

    fetch(API_URL)
      .then(r => {
        if(!r.ok) throw new Error('ネットワークエラー: ' + r.status);
        return r.json();
      })
      .then(data => {
        if(!Array.isArray(data)) throw new Error('返ってきたデータが配列ではありません');
        if(data.length===0){
          document.getElementById('status').textContent = '公開されている質問はまだありません';
          return;
        }
        const tbody = data.map(row => `
          <tr>
            <td>${row["タイムスタンプ"] || ''}</td>
            <td>${row["質問する人の名前（匿名でも可）"] || ''}</td>
            <td>${row["誰への質問か"] || ''}</td>
            <td>${row["質問内容"] || ''}</td>
          </tr>
        `).join('');
        document.querySelector('#qaTable tbody').innerHTML = tbody;
        document.getElementById('status').style.display = 'none';
        document.getElementById('qaTable').style.display = 'table';
        $('#qaTable').DataTable({
          order: [[0,'desc']],
          responsive: true,
          language: { url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/ja.json" }
        });
      })
      .catch(err => {
        console.error(err);
        showError('データ取得に失敗しました。再読み込みしてください。');
      });
  </script>
</body>
</html>
